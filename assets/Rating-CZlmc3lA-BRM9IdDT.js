import{l as a,$ as e,_ as l,x as s,a as i,H as t,N as n,q as c,Z as r,U as d,g as v,h as o,u,f as p,J as m,e as g,b as y,p as f,A as h,r as b,d as k,j as w}from"./index-CXpj-iG1.js";import{i as _}from"./celebrity-Dpk6slWv-CjbodMFZ.js";import{s as x,t as C}from"./rating-BVRVyCcO-BR8_6q4W.js";const j={class:"rating-page"},V={class:"container"},U={class:"celebrity-grid"},z=["onClick"],I={class:"celebrity-avatar-wrapper"},O=["src","alt"],A={key:0,class:"celebrity-score-badge"},F={class:"score-number"},N={class:"celebrity-info"},R={class:"field"},S={class:"stats"},$={class:"stat-item"},q={key:0,class:"rating-dialog-content"},B={class:"celebrity-preview"},D=["src","alt"],H={class:"hupu-rating-section"},J={class:"rating-categories"},L={class:"category-header"},T={class:"category-name"},W={class:"category-score"},Z={class:"rating-bars"},E=["onClick"],G={class:"overall-score"},K={class:"overall-value"},M={class:"comment-section"},P={class:"dialog-actions"},Q={class:"recent-ratings-section"},X={class:"ratings-list"},Y={class:"rating-item-header"},aa={class:"user-info"},ea={class:"user-details"},la={class:"username"},sa={class:"rating-time"},ia={class:"rating-score-display"},ta={class:"score-value"},na={class:"rating-comment"},ca={class:"rating-celebrity"},ra={class:"celebrity-name"},da=a({__name:"Rating",setup(a){const da=p(),va=e(),oa=l([]),ua=l(null),pa=l(!1),ma=l(!1),ga=l(""),ya=l([]),fa=[{key:"technical",name:"技术能力"},{key:"influence",name:"影响力"},{key:"innovation",name:"创新性"}],ha=l({technical:5,influence:5,innovation:5}),ba=s(()=>Object.values(ha.value).reduce((a,e)=>a+e,0)/Object.keys(ha.value).length),ka=async()=>{try{const a=await _({page:1,size:100});oa.value=a.data.list||[]}catch(a){}},wa=async()=>{try{const a=await x({page:1,size:20});ya.value=a.data.list||[]}catch(a){}},_a=async()=>{var a,e;if(ga.value.trim()){ma.value=!0;try{await C({celebrityId:ua.value.id,score:ba.value,comment:ga.value,details:ha.value}),u.success("评分成功"),pa.value=!1,wa(),ka()}catch(l){u.error((null==(e=null==(a=l.response)?void 0:a.data)?void 0:e.message)||"提交失败")}finally{ma.value=!1}}else u.warning("请输入评论内容")};return i(()=>{ka(),wa()}),(a,e)=>{var l;const s=k("el-icon"),i=k("el-input"),p=k("el-button"),_=k("el-dialog"),x=k("el-avatar");return n(),t("div",j,[c("div",V,[e[10]||(e[10]=r('<h1 class="page-title" data-v-2292d4e0><span class="flip-char" style="animation-delay:0s;" data-v-2292d4e0>名</span><span class="flip-char" style="animation-delay:0.15s;" data-v-2292d4e0>人</span><span class="flip-char" style="animation-delay:0.3s;" data-v-2292d4e0>评</span><span class="flip-char" style="animation-delay:0.45s;" data-v-2292d4e0>分</span></h1>',1)),c("div",U,[(n(!0),t(v,null,o(oa.value,a=>(n(),t("div",{key:a.id,class:"celebrity-card",onClick:e=>(a=>{if(!va.isLoggedIn)return u.warning("请先登录"),void da.push("/login");ua.value=a,pa.value=!0,ha.value={technical:5,influence:5,innovation:5},ga.value=""})(a)},[c("div",I,[c("img",{src:a.avatar||"/images/default-avatar.jpg",alt:a.name,class:"celebrity-avatar"},null,8,O),a.averageScore?(n(),t("div",A,[c("span",F,g(a.averageScore.toFixed(1)),1),e[3]||(e[3]=c("span",{class:"score-label"},"分",-1))])):m("",!0)]),c("div",N,[c("h3",null,g(a.name),1),c("p",R,g(a.field),1),c("div",S,[c("span",$,[d(s,null,{default:f(()=>[d(h(b))]),_:1}),y(" "+g(a.ratingCount||0)+"人评分 ",1)])])])],8,z))),128))]),d(_,{modelValue:pa.value,"onUpdate:modelValue":e[2]||(e[2]=a=>pa.value=a),title:`为 ${null==(l=ua.value)?void 0:l.name} 评分`,width:"600px",class:"rating-dialog"},{default:f(()=>[ua.value?(n(),t("div",q,[c("div",B,[c("img",{src:ua.value.avatar||"/images/default-avatar.jpg",alt:ua.value.name},null,8,D),c("div",null,[c("h3",null,g(ua.value.name),1),c("p",null,g(ua.value.field),1)])]),c("div",H,[c("div",J,[(n(),t(v,null,o(fa,a=>c("div",{class:"rating-category",key:a.key},[c("div",L,[c("span",T,g(a.name),1),c("span",W,g(ha.value[a.key])+"分",1)]),c("div",Z,[(n(),t(v,null,o(10,e=>c("div",{key:e,class:w(["rating-bar",{active:ha.value[a.key]>=e}]),onClick:l=>{return s=a.key,i=e,void(ha.value[s]=i);var s,i}},g(e),11,E)),64))])])),64))]),c("div",G,[e[4]||(e[4]=c("span",{class:"overall-label"},"综合评分",-1)),c("span",K,g(ba.value.toFixed(1)),1)])]),c("div",M,[d(i,{modelValue:ga.value,"onUpdate:modelValue":e[0]||(e[0]=a=>ga.value=a),type:"textarea",rows:4,placeholder:"说说你的看法...",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),c("div",P,[d(p,{onClick:e[1]||(e[1]=a=>pa.value=!1)},{default:f(()=>[...e[5]||(e[5]=[y("取消",-1)])]),_:1}),d(p,{type:"primary",onClick:_a,loading:ma.value},{default:f(()=>[...e[6]||(e[6]=[y("提交评分",-1)])]),_:1},8,["loading"])])])):m("",!0)]),_:1},8,["modelValue","title"]),c("div",Q,[e[9]||(e[9]=c("h2",{class:"section-title"},"最新评分",-1)),c("div",X,[(n(!0),t(v,null,o(ya.value,a=>(n(),t("div",{key:a.id,class:"rating-item"},[c("div",Y,[c("div",aa,[d(x,{size:40},{default:f(()=>{var e;return[y(g(null==(e=a.username)?void 0:e.charAt(0).toUpperCase()),1)]}),_:2},1024),c("div",ea,[c("span",la,g(a.username),1),c("span",sa,g(a.createTime),1)])]),c("div",ia,[c("span",ta,g(a.score),1),e[7]||(e[7]=c("span",{class:"score-max"},"/10",-1))])]),c("div",na,g(a.comment),1),c("div",ca,[e[8]||(e[8]=y("评价了 ",-1)),c("span",ra,g(a.celebrityName),1)])]))),128))])])])])}}},[["__scopeId","data-v-2292d4e0"]]);export{da as default};
