import{_ as a,u as e,r as l,o as s,d as t,e as n,h as d,f as u,j as i,g as r,i as c,l as o,k as v,t as m,p,B as y,b as f,H as h}from"./index-MMiF18kJ.js";import{a as b,l as g}from"./celebrity-CU8lBPIc.js";import{g as _,s as k}from"./danmu-Bz7ynQsb.js";import{D as w}from"./DanmuScroll-DtzXKShH.js";const I={key:0,class:"detail-page"},L={class:"danmu-scroll-layer"},x={class:"container"},H={class:"celebrity-header"},V=["src"],j={class:"celebrity-info"},C={class:"field"},D={class:"actions"},M=["innerHTML"],S=["innerHTML"],T={class:"danmu-controls"},q={key:0,class:"danmu-input"},U={key:1,class:"login-tip"},z=a({__name:"HallDetail",setup(a){const z=f(),A=e(),B=l(null),K=l([]),N=l(""),R=l(null),$=l(!0);let E=null;const F=async()=>{try{const a=await _({celebrityId:z.params.id,size:100});K.value=a.data.list||[]}catch(a){}},G=async()=>{try{await g(z.params.id),h.success("点赞成功"),B.value.likes++}catch(a){}},J=async()=>{var a,e;if(N.value.trim())if(A.isLoggedIn)try{const a=await k({content:N.value,celebrityId:z.params.id});a.data&&(K.value.push(a.data),R.value&&$.value&&R.value.addNewDanmu(a.data)),N.value=""}catch(l){h.error((null==(e=null==(a=l.response)?void 0:a.data)?void 0:e.message)||"发送失败")}else h.warning("请先登录")},O=a=>{const e=document.querySelector(".danmu-scroll-layer");e&&(e.style.display=a?"block":"none")};return s(()=>{(async()=>{try{const a=await b(z.params.id);B.value=a.data}catch(a){}})(),F(),E=setInterval(()=>{F()},5e3)}),t(()=>{E&&clearInterval(E)}),(a,e)=>{const l=v("ArrowLeft"),s=v("el-icon"),t=v("el-button"),f=v("Star"),h=v("el-card"),b=v("el-switch"),g=v("el-input"),_=v("el-text");return B.value?(u(),n("div",I,[i("div",L,[r(w,{ref_key:"danmuScrollRef",ref:R,danmus:K.value,speed:3,trackCount:10},null,8,["danmus"])]),i("div",x,[r(t,{onClick:e[0]||(e[0]=e=>a.$router.back()),class:"back-btn"},{default:c(()=>[r(s,null,{default:c(()=>[r(l)]),_:1}),e[3]||(e[3]=o(" 返回 ",-1))]),_:1}),i("div",H,[i("img",{src:B.value.avatar,class:"celebrity-avatar"},null,8,V),i("div",j,[i("h1",null,m(B.value.name),1),i("p",C,m(B.value.field),1),i("div",D,[r(t,{type:"primary",onClick:G,disabled:!p(A).isLoggedIn},{default:c(()=>[r(s,null,{default:c(()=>[r(f)]),_:1}),o(" 点赞 ("+m(B.value.likes)+") ",1)]),_:1},8,["disabled"])])])]),r(h,{class:"content-card"},{default:c(()=>[e[4]||(e[4]=i("h2",null,"生平介绍",-1)),i("div",{innerHTML:B.value.biography},null,8,M)]),_:1}),r(h,{class:"content-card"},{default:c(()=>[e[5]||(e[5]=i("h2",null,"主要贡献",-1)),i("div",{innerHTML:B.value.contributions},null,8,S)]),_:1}),r(h,{class:"danmu-card"},{default:c(()=>[e[8]||(e[8]=i("h2",null,"弹幕互动",-1)),i("div",T,[r(b,{modelValue:$.value,"onUpdate:modelValue":e[1]||(e[1]=a=>$.value=a),"active-text":"显示弹幕","inactive-text":"隐藏弹幕",onChange:O},null,8,["modelValue"])]),p(A).isLoggedIn?(u(),n("div",q,[r(g,{modelValue:N.value,"onUpdate:modelValue":e[2]||(e[2]=a=>N.value=a),placeholder:"发送弹幕...",onKeyup:y(J,["enter"]),maxlength:"50","show-word-limit":""},{append:c(()=>[r(t,{onClick:J,type:"primary"},{default:c(()=>[...e[6]||(e[6]=[o("发送",-1)])]),_:1})]),_:1},8,["modelValue"])])):(u(),n("div",U,[r(_,{type:"info"},{default:c(()=>[...e[7]||(e[7]=[o("请先登录后发送弹幕",-1)])]),_:1})]))]),_:1})])])):d("",!0)}}},[["__scopeId","data-v-997ed97e"]]);export{z as default};
