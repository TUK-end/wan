import{l as a,$ as e,_ as l,a as s,n as t,o as n,H as d,J as u,N as i,q as r,U as c,p as o,b as v,d as m,e as p,A as y,m as f,u as h}from"./index-CXpj-iG1.js";import{s as b,l as _}from"./celebrity-Dpk6slWv-CjbodMFZ.js";import{s as g,m as k}from"./danmu-Bwh-s-Om-BgVir-Fi.js";import{v as w}from"./DanmuScroll-B--3PFvV-BR1nXCul.js";const I={key:0,class:"detail-page"},L={class:"danmu-scroll-layer"},V={class:"container"},x={class:"celebrity-header"},H=["src"],C={class:"celebrity-info"},j={class:"field"},D={class:"actions"},M=["innerHTML"],S=["innerHTML"],T={class:"danmu-controls"},q={key:0,class:"danmu-input"},U={key:1,class:"login-tip"},A=a({__name:"HallDetail",setup(a){const A=t(),B=e(),N=l(null),$=l([]),z=l(""),F=l(null),J=l(!0);let K=null;const O=async()=>{try{const a=await g({celebrityId:A.params.id,size:100});$.value=a.data.list||[]}catch(a){}},P=async()=>{try{await _(A.params.id),h.success("点赞成功"),N.value.likes++}catch(a){}},R=async()=>{var a,e;if(z.value.trim())if(B.isLoggedIn)try{const a=await k({content:z.value,celebrityId:A.params.id});a.data&&($.value.push(a.data),F.value&&J.value&&F.value.addNewDanmu(a.data)),z.value=""}catch(l){h.error((null==(e=null==(a=l.response)?void 0:a.data)?void 0:e.message)||"发送失败")}else h.warning("请先登录")},W=a=>{const e=document.querySelector(".danmu-scroll-layer");e&&(e.style.display=a?"block":"none")};return s(()=>{(async()=>{try{const a=await b(A.params.id);N.value=a.data}catch(a){}})(),O(),K=setInterval(()=>{O()},5e3)}),n(()=>{K&&clearInterval(K)}),(a,e)=>{const l=m("ArrowLeft"),s=m("el-icon"),t=m("el-button"),n=m("Star"),h=m("el-card"),b=m("el-switch"),_=m("el-input"),g=m("el-text");return N.value?(i(),d("div",I,[r("div",L,[c(w,{ref_key:"danmuScrollRef",ref:F,danmus:$.value,speed:3,trackCount:10},null,8,["danmus"])]),r("div",V,[c(t,{onClick:e[0]||(e[0]=e=>a.$router.back()),class:"back-btn"},{default:o(()=>[c(s,null,{default:o(()=>[c(l)]),_:1}),e[3]||(e[3]=v(" 返回 ",-1))]),_:1}),r("div",x,[r("img",{src:N.value.avatar,class:"celebrity-avatar"},null,8,H),r("div",C,[r("h1",null,p(N.value.name),1),r("p",j,p(N.value.field),1),r("div",D,[c(t,{type:"primary",onClick:P,disabled:!y(B).isLoggedIn},{default:o(()=>[c(s,null,{default:o(()=>[c(n)]),_:1}),v(" 点赞 ("+p(N.value.likes)+") ",1)]),_:1},8,["disabled"])])])]),c(h,{class:"content-card"},{default:o(()=>[e[4]||(e[4]=r("h2",null,"生平介绍",-1)),r("div",{innerHTML:N.value.biography},null,8,M)]),_:1}),c(h,{class:"content-card"},{default:o(()=>[e[5]||(e[5]=r("h2",null,"主要贡献",-1)),r("div",{innerHTML:N.value.contributions},null,8,S)]),_:1}),c(h,{class:"danmu-card"},{default:o(()=>[e[8]||(e[8]=r("h2",null,"弹幕互动",-1)),r("div",T,[c(b,{modelValue:J.value,"onUpdate:modelValue":e[1]||(e[1]=a=>J.value=a),"active-text":"显示弹幕","inactive-text":"隐藏弹幕",onChange:W},null,8,["modelValue"])]),y(B).isLoggedIn?(i(),d("div",q,[c(_,{modelValue:z.value,"onUpdate:modelValue":e[2]||(e[2]=a=>z.value=a),placeholder:"发送弹幕...",onKeyup:f(R,["enter"]),maxlength:"50","show-word-limit":""},{append:o(()=>[c(t,{onClick:R,type:"primary"},{default:o(()=>[...e[6]||(e[6]=[v("发送",-1)])]),_:1})]),_:1},8,["modelValue"])])):(i(),d("div",U,[c(g,{type:"info"},{default:o(()=>[...e[7]||(e[7]=[v("请先登录后发送弹幕",-1)])]),_:1})]))]),_:1})])])):u("",!0)}}},[["__scopeId","data-v-997ed97e"]]);export{A as default};
