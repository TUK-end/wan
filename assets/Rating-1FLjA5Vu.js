import{_ as a,u as e,r as l,c as s,o as i,e as t,f as n,j as c,s as r,g as d,F as v,x as o,i as u,h as m,t as p,k as g,l as y,H as f,v as h,p as b,C as k,q as w}from"./index-CYfi38du.js";import{g as _}from"./celebrity-BofdgKeQ.js";import{a as x,s as C}from"./rating-C6_66R7H.js";const j={class:"rating-page"},V={class:"container"},z={class:"celebrity-grid"},F=["onClick"],I={class:"celebrity-avatar-wrapper"},U=["src","alt"],O={key:0,class:"celebrity-score-badge"},S={class:"score-number"},q={class:"celebrity-info"},A={class:"field"},H={class:"stats"},L={class:"stat-item"},N={key:0,class:"rating-dialog-content"},R={class:"celebrity-preview"},T=["src","alt"],$={class:"hupu-rating-section"},B={class:"rating-categories"},D={class:"category-header"},E={class:"category-name"},G={class:"category-score"},J={class:"rating-bars"},K=["onClick"],M={class:"overall-score"},P={class:"overall-value"},Q={class:"comment-section"},W={class:"dialog-actions"},X={class:"recent-ratings-section"},Y={class:"ratings-list"},Z={class:"rating-item-header"},aa={class:"user-info"},ea={class:"user-details"},la={class:"username"},sa={class:"rating-time"},ia={class:"rating-score-display"},ta={class:"score-value"},na={class:"rating-comment"},ca={class:"rating-celebrity"},ra={class:"celebrity-name"},da=a({__name:"Rating",setup(a){const da=h(),va=e(),oa=l([]),ua=l(null),ma=l(!1),pa=l(!1),ga=l(""),ya=l([]),fa=[{key:"technical",name:"技术能力"},{key:"influence",name:"影响力"},{key:"innovation",name:"创新性"}],ha=l({technical:5,influence:5,innovation:5}),ba=s(()=>Object.values(ha.value).reduce((a,e)=>a+e,0)/Object.keys(ha.value).length),ka=async()=>{try{const a=await _({page:1,size:100});oa.value=a.data.list||[]}catch(a){}},wa=async()=>{try{const a=await x({page:1,size:20});ya.value=a.data.list||[]}catch(a){}},_a=async()=>{var a,e;if(ga.value.trim()){pa.value=!0;try{await C({celebrityId:ua.value.id,score:ba.value,comment:ga.value,details:ha.value}),f.success("评分成功"),ma.value=!1,wa(),ka()}catch(l){f.error((null==(e=null==(a=l.response)?void 0:a.data)?void 0:e.message)||"提交失败")}finally{pa.value=!1}}else f.warning("请输入评论内容")};return i(()=>{ka(),wa()}),(a,e)=>{var l;const s=g("el-icon"),i=g("el-input"),h=g("el-button"),_=g("el-dialog"),x=g("el-avatar");return n(),t("div",j,[c("div",V,[e[10]||(e[10]=r('<h1 class="page-title" data-v-2292d4e0><span class="flip-char" style="animation-delay:0s;" data-v-2292d4e0>名</span><span class="flip-char" style="animation-delay:0.15s;" data-v-2292d4e0>人</span><span class="flip-char" style="animation-delay:0.3s;" data-v-2292d4e0>评</span><span class="flip-char" style="animation-delay:0.45s;" data-v-2292d4e0>分</span></h1>',1)),c("div",z,[(n(!0),t(v,null,o(oa.value,a=>(n(),t("div",{key:a.id,class:"celebrity-card",onClick:e=>(a=>{if(!va.isLoggedIn)return f.warning("请先登录"),void da.push("/login");ua.value=a,ma.value=!0,ha.value={technical:5,influence:5,innovation:5},ga.value=""})(a)},[c("div",I,[c("img",{src:a.avatar||"/images/default-avatar.jpg",alt:a.name,class:"celebrity-avatar"},null,8,U),a.averageScore?(n(),t("div",O,[c("span",S,p(a.averageScore.toFixed(1)),1),e[3]||(e[3]=c("span",{class:"score-label"},"分",-1))])):m("",!0)]),c("div",q,[c("h3",null,p(a.name),1),c("p",A,p(a.field),1),c("div",H,[c("span",L,[d(s,null,{default:u(()=>[d(b(k))]),_:1}),y(" "+p(a.ratingCount||0)+"人评分 ",1)])])])],8,F))),128))]),d(_,{modelValue:ma.value,"onUpdate:modelValue":e[2]||(e[2]=a=>ma.value=a),title:`为 ${null==(l=ua.value)?void 0:l.name} 评分`,width:"600px",class:"rating-dialog"},{default:u(()=>[ua.value?(n(),t("div",N,[c("div",R,[c("img",{src:ua.value.avatar||"/images/default-avatar.jpg",alt:ua.value.name},null,8,T),c("div",null,[c("h3",null,p(ua.value.name),1),c("p",null,p(ua.value.field),1)])]),c("div",$,[c("div",B,[(n(),t(v,null,o(fa,a=>c("div",{class:"rating-category",key:a.key},[c("div",D,[c("span",E,p(a.name),1),c("span",G,p(ha.value[a.key])+"分",1)]),c("div",J,[(n(),t(v,null,o(10,e=>c("div",{key:e,class:w(["rating-bar",{active:ha.value[a.key]>=e}]),onClick:l=>((a,e)=>{ha.value[a]=e})(a.key,e)},p(e),11,K)),64))])])),64))]),c("div",M,[e[4]||(e[4]=c("span",{class:"overall-label"},"综合评分",-1)),c("span",P,p(ba.value.toFixed(1)),1)])]),c("div",Q,[d(i,{modelValue:ga.value,"onUpdate:modelValue":e[0]||(e[0]=a=>ga.value=a),type:"textarea",rows:4,placeholder:"说说你的看法...",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),c("div",W,[d(h,{onClick:e[1]||(e[1]=a=>ma.value=!1)},{default:u(()=>[...e[5]||(e[5]=[y("取消",-1)])]),_:1}),d(h,{type:"primary",onClick:_a,loading:pa.value},{default:u(()=>[...e[6]||(e[6]=[y("提交评分",-1)])]),_:1},8,["loading"])])])):m("",!0)]),_:1},8,["modelValue","title"]),c("div",X,[e[9]||(e[9]=c("h2",{class:"section-title"},"最新评分",-1)),c("div",Y,[(n(!0),t(v,null,o(ya.value,a=>(n(),t("div",{key:a.id,class:"rating-item"},[c("div",Z,[c("div",aa,[d(x,{size:40},{default:u(()=>{var e;return[y(p(null==(e=a.username)?void 0:e.charAt(0).toUpperCase()),1)]}),_:2},1024),c("div",ea,[c("span",la,p(a.username),1),c("span",sa,p(a.createTime),1)])]),c("div",ia,[c("span",ta,p(a.score),1),e[7]||(e[7]=c("span",{class:"score-max"},"/10",-1))])]),c("div",na,p(a.comment),1),c("div",ca,[e[8]||(e[8]=y("评价了 ",-1)),c("span",ra,p(a.celebrityName),1)])]))),128))])])])])}}},[["__scopeId","data-v-2292d4e0"]]);export{da as default};
