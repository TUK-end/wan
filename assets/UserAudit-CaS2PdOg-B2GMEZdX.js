import{l as e,_ as a,a as l,H as t,N as u,U as d,p as s,k as i,a9 as o,c as n,d as r,b as c,e as v,J as p,a5 as m,aa as f,u as y,q as _,ab as g}from"./index-CXpj-iG1.js";const w={class:"user-audit-page"},h={class:"card-header"},b=e({__name:"UserAudit",setup(e){const b=a(!1),k=a([]),C=a(1),E=a(20),R=a(0),S=a(!1),x=a(!1),D=a(null),V=a({auditReason:""}),z=async()=>{var e,a;b.value=!0;try{const e=await g({page:C.value,size:E.value});k.value=e.data.list,R.value=e.data.total}catch(l){y.error((null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.message)||"加载失败")}finally{b.value=!1}},P=async()=>{var e,a;if(V.value.auditReason.trim())try{await f(D.value.id,{auditStatus:"REJECTED",auditReason:V.value.auditReason}),y.success("已拒绝该用户的注册申请"),S.value=!1,z()}catch(l){y.error((null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.message)||"审核失败")}else y.warning("请输入拒绝原因")},N=e=>e?new Date(e).toLocaleString("zh-CN"):"-";return l(()=>{z()}),(e,a)=>{const l=r("el-tag"),g=r("el-table-column"),T=r("el-button"),U=r("el-table"),I=r("el-pagination"),A=r("el-card"),G=r("el-input"),J=r("el-form-item"),j=r("el-form"),O=r("el-dialog"),B=r("el-descriptions-item"),q=r("el-descriptions"),H=o("loading");return u(),t("div",w,[d(A,{class:"page-card"},{header:s(()=>[_("div",h,[a[7]||(a[7]=_("h2",null,"用户审核管理",-1)),d(l,{type:"warning"},{default:s(()=>[c("待审核: "+v(R.value),1)]),_:1})])]),default:s(()=>[i((u(),n(U,{data:k.value,style:{width:"100%"}},{default:s(()=>[d(g,{prop:"id",label:"ID",width:"80"}),d(g,{prop:"username",label:"用户名",width:"150"}),d(g,{prop:"email",label:"邮箱",width:"200"}),d(g,{prop:"createTime",label:"注册时间",width:"180"},{default:s(({row:e})=>[c(v(N(e.createTime)),1)]),_:1}),d(g,{prop:"auditStatus",label:"审核状态",width:"120"},{default:s(({row:e})=>["PENDING"===e.auditStatus?(u(),n(l,{key:0,type:"warning"},{default:s(()=>[...a[8]||(a[8]=[c("待审核",-1)])]),_:1})):"APPROVED"===e.auditStatus?(u(),n(l,{key:1,type:"success"},{default:s(()=>[...a[9]||(a[9]=[c("已通过",-1)])]),_:1})):"REJECTED"===e.auditStatus?(u(),n(l,{key:2,type:"danger"},{default:s(()=>[...a[10]||(a[10]=[c("已拒绝",-1)])]),_:1})):p("",!0)]),_:1}),d(g,{label:"操作",width:"250",fixed:"right"},{default:s(({row:e})=>["PENDING"===e.auditStatus?(u(),n(T,{key:0,type:"success",size:"small",onClick:a=>(async e=>{var a,l;try{await m.confirm(`确定要通过用户 "${e.username}" 的注册申请吗？`,"确认审核",{confirmButtonText:"确定",cancelButtonText:"取消",type:"success"}),await f(e.id,{auditStatus:"APPROVED",auditReason:""}),y.success("审核成功"),z()}catch(t){"cancel"!==t&&y.error((null==(l=null==(a=t.response)?void 0:a.data)?void 0:l.message)||"审核失败")}})(e)},{default:s(()=>[...a[11]||(a[11]=[c(" 通过 ",-1)])]),_:1},8,["onClick"])):p("",!0),"PENDING"===e.auditStatus?(u(),n(T,{key:1,type:"danger",size:"small",onClick:a=>{return l=e,D.value=l,V.value.auditReason="",void(S.value=!0);var l}},{default:s(()=>[...a[12]||(a[12]=[c(" 拒绝 ",-1)])]),_:1},8,["onClick"])):p("",!0),"PENDING"!==e.auditStatus?(u(),n(T,{key:2,type:"info",size:"small",onClick:a=>{return l=e,D.value=l,void(x.value=!0);var l}},{default:s(()=>[...a[13]||(a[13]=[c(" 查看详情 ",-1)])]),_:1},8,["onClick"])):p("",!0)]),_:1})]),_:1},8,["data"])),[[H,b.value]]),d(I,{"current-page":C.value,"onUpdate:currentPage":a[0]||(a[0]=e=>C.value=e),"page-size":E.value,"onUpdate:pageSize":a[1]||(a[1]=e=>E.value=e),total:R.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:z,onCurrentChange:z,style:{"margin-top":"20px","justify-content":"center"}},null,8,["current-page","page-size","total"])]),_:1}),d(O,{modelValue:S.value,"onUpdate:modelValue":a[4]||(a[4]=e=>S.value=e),title:"拒绝审核",width:"500px"},{footer:s(()=>[d(T,{onClick:a[3]||(a[3]=e=>S.value=!1)},{default:s(()=>[...a[14]||(a[14]=[c("取消",-1)])]),_:1}),d(T,{type:"danger",onClick:P},{default:s(()=>[...a[15]||(a[15]=[c("确认拒绝",-1)])]),_:1})]),default:s(()=>[d(j,{model:V.value,"label-width":"100px"},{default:s(()=>[d(J,{label:"拒绝原因"},{default:s(()=>[d(G,{modelValue:V.value.auditReason,"onUpdate:modelValue":a[2]||(a[2]=e=>V.value.auditReason=e),type:"textarea",rows:4,placeholder:"请输入拒绝原因",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),d(O,{modelValue:x.value,"onUpdate:modelValue":a[6]||(a[6]=e=>x.value=e),title:"审核详情",width:"600px"},{footer:s(()=>[d(T,{onClick:a[5]||(a[5]=e=>x.value=!1)},{default:s(()=>[...a[18]||(a[18]=[c("关闭",-1)])]),_:1})]),default:s(()=>[D.value?(u(),n(q,{key:0,column:1,border:""},{default:s(()=>[d(B,{label:"用户名"},{default:s(()=>[c(v(D.value.username),1)]),_:1}),d(B,{label:"邮箱"},{default:s(()=>[c(v(D.value.email),1)]),_:1}),d(B,{label:"注册时间"},{default:s(()=>[c(v(N(D.value.createTime)),1)]),_:1}),d(B,{label:"审核状态"},{default:s(()=>["APPROVED"===D.value.auditStatus?(u(),n(l,{key:0,type:"success"},{default:s(()=>[...a[16]||(a[16]=[c("已通过",-1)])]),_:1})):"REJECTED"===D.value.auditStatus?(u(),n(l,{key:1,type:"danger"},{default:s(()=>[...a[17]||(a[17]=[c("已拒绝",-1)])]),_:1})):p("",!0)]),_:1}),d(B,{label:"审核时间"},{default:s(()=>[c(v(N(D.value.auditTime)),1)]),_:1}),D.value.auditReason?(u(),n(B,{key:0,label:"审核备注"},{default:s(()=>[c(v(D.value.auditReason),1)]),_:1})):p("",!0)]),_:1})):p("",!0)]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-95b10017"]]);export{b as default};
