import{_ as a,r as e,o as t,d as l,e as n,f as u,F as s,x as r,y as o,j as i,t as f}from"./index-CYfi38du.js";const c={class:"danmu-username"},m={class:"danmu-text"},v=a({__name:"DanmuScroll",props:{danmus:{type:Array,default:()=>[]},speed:{type:Number,default:2},trackCount:{type:Number,default:8},trackHeight:{type:Number,default:40}},setup(a,{expose:v}){const d=a,p=e(null),h=e([]),b=e([]),k=e([]);let y=null,g=0;const D=["#00ff88","#00d4ff","#ff00ff","#ffff00","#ff6b6b","#4ecdc4","#95e1d3","#f38181"],x=a=>{b.value.push({...a,key:"danmu-"+g++,color:D[Math.floor(Math.random()*D.length)]})},_=()=>{if(0===b.value.length||!p.value)return;const a=(()=>{const a=Date.now();for(let e=0;e<k.value.length;e++){const t=k.value[e];if(t.available&&a-t.lastDanmuTime>1e3)return e}return-1})();if(-1===a)return;const e=b.value.shift(),t=p.value.offsetWidth;h.value.push({...e,track:a,position:t,startTime:Date.now()}),k.value[a].available=!1,k.value[a].lastDanmuTime=Date.now()},w=()=>{if(!p.value)return;const a=p.value.offsetWidth;h.value=h.value.filter(e=>(e.position-=d.speed,e.position<-300?(k.value[e.track].available=!0,!1):(e.position<a-200&&!k.value[e.track].available&&(k.value[e.track].available=!0),!0))),b.value.length>0&&_(),y=requestAnimationFrame(w)},A=e(0),N=()=>{if(d.danmus.length>A.value){d.danmus.slice(A.value).forEach(a=>x(a)),A.value=d.danmus.length}};return v({addNewDanmu:a=>{x(a)}}),t(()=>{k.value=Array(d.trackCount).fill(null).map(()=>({available:!0,lastDanmuTime:0})),A.value=d.danmus.length,d.danmus.forEach(a=>x(a)),w();const a=setInterval(N,500);l(()=>clearInterval(a))}),l(()=>{y&&cancelAnimationFrame(y)}),(e,t)=>(u(),n("div",{class:"danmu-container",ref_key:"containerRef",ref:p},[(u(!0),n(s,null,r(h.value,e=>(u(),n("div",{key:e.key,class:"danmu-item",style:o({top:e.track*a.trackHeight+"px",left:e.position+"px",color:e.color})},[i("span",c,f(e.username)+":",1),i("span",m,f(e.content),1)],4))),128))],512))}},[["__scopeId","data-v-b4b09681"]]);export{v as D};
