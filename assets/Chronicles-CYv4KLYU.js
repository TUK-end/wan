import{g as e,d as l,u as a,c as t}from"./chronicle-DgajS3jK.js";import{_ as d,u,r as o,c as r,o as i,e as s,f as n,j as p,g as c,i as v,l as m,k as w,m as f,p as h,ac as b,H as y,a5 as V}from"./index-MMiF18kJ.js";const g={class:"chronicles-page"},_={class:"toolbar"},U={key:1,style:{color:"#999"}},k={class:"image-upload"},D=["src"],x=d({__name:"Chronicles",setup(d){const x=u(),C=o([]),Y=o(!1),M=o({}),j=o(!1),z=r(()=>"/api/api/upload/image"),L=r(()=>({Authorization:`Bearer ${x.token}`})),O=async()=>{var l;try{const a=await e();C.value=(null==(l=a.data)?void 0:l.list)||a.data||[]}catch(a){y.error("加载编年史列表失败")}},B=e=>{M.value=e?{...e}:{},Y.value=!0},I=e=>e?(e.startsWith("http"),e):"",N=e=>{const l=e.type.startsWith("image/"),a=e.size/1024/1024<10;return l?!!a||(y.error("图片大小不能超过 10MB!"),!1):(y.error("只能上传图片文件!"),!1)},W=e=>{200===e.code?(M.value.imageUrl=e.data,y.success("上传成功")):y.error(e.message||"上传失败")},A=e=>{y.error("上传失败，请重试")},H=async()=>{if(M.value.title)if(M.value.winners)if(M.value.awardLevel){M.value.awardDate&&!M.value.year&&(M.value.year=parseInt(M.value.awardDate.split("-")[0])),void 0===M.value.featured&&(M.value.featured=!0),void 0===M.value.displayOrder&&(M.value.displayOrder=0),j.value=!0;try{M.value.id?await a(M.value.id,M.value):await t(M.value),y.success("保存成功"),Y.value=!1,O()}catch(e){y.error("保存失败")}finally{j.value=!1}}else y.warning("请选择获奖等级");else y.warning("请输入获奖人");else y.warning("请输入标题")};return i(()=>{O()}),(e,a)=>{const t=w("el-button"),d=w("el-table-column"),u=w("el-image"),o=w("el-table"),r=w("el-icon"),i=w("el-upload"),x=w("el-form-item"),$=w("el-input"),q=w("el-option"),E=w("el-select"),F=w("el-date-picker"),G=w("el-input-number"),J=w("el-switch"),K=w("el-form"),P=w("el-dialog");return n(),s("div",g,[a[18]||(a[18]=p("h1",null,"编年史管理",-1)),p("div",_,[c(t,{type:"primary",onClick:a[0]||(a[0]=e=>B())},{default:v(()=>[...a[12]||(a[12]=[m("添加编年史",-1)])]),_:1})]),c(o,{data:C.value,style:{width:"100%"}},{default:v(()=>[c(d,{prop:"id",label:"ID",width:"80"}),c(d,{label:"获奖图片",width:"120"},{default:v(({row:e})=>[e.imageUrl?(n(),f(u,{key:0,src:I(e.imageUrl),style:{width:"80px",height:"80px","border-radius":"4px"},fit:"cover"},null,8,["src"])):(n(),s("span",U,"无"))]),_:1}),c(d,{prop:"title",label:"标题",width:"200"}),c(d,{prop:"competitionName",label:"比赛名称",width:"180"}),c(d,{prop:"winners",label:"获奖人",width:"150"}),c(d,{prop:"awardLevel",label:"获奖等级",width:"100"}),c(d,{prop:"awardDate",label:"获奖日期",width:"120"}),c(d,{prop:"year",label:"年份",width:"80"}),c(d,{prop:"description",label:"描述","show-overflow-tooltip":""}),c(d,{label:"操作",width:"200"},{default:v(({row:e})=>[c(t,{size:"small",onClick:l=>B(e)},{default:v(()=>[...a[13]||(a[13]=[m("编辑",-1)])]),_:1},8,["onClick"]),c(t,{size:"small",type:"danger",onClick:a=>(async e=>{try{await V.confirm("确定删除该编年史记录吗?","提示",{type:"warning"}),await l(e),y.success("删除成功"),O()}catch(a){"cancel"!==a&&y.error("删除失败")}})(e.id)},{default:v(()=>[...a[14]||(a[14]=[m("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),c(P,{modelValue:Y.value,"onUpdate:modelValue":a[11]||(a[11]=e=>Y.value=e),title:M.value.id?"编辑编年史":"添加编年史",width:"600px"},{footer:v(()=>[c(t,{onClick:a[10]||(a[10]=e=>Y.value=!1)},{default:v(()=>[...a[16]||(a[16]=[m("取消",-1)])]),_:1}),c(t,{type:"primary",onClick:H,loading:j.value},{default:v(()=>[...a[17]||(a[17]=[m("保存",-1)])]),_:1},8,["loading"])]),default:v(()=>[c(K,{model:M.value,"label-width":"100px"},{default:v(()=>[c(x,{label:"获奖图片"},{default:v(()=>[p("div",k,[c(i,{class:"image-uploader",action:z.value,headers:L.value,"show-file-list":!1,"on-success":W,"on-error":A,"before-upload":N},{default:v(()=>[M.value.imageUrl?(n(),s("img",{key:0,src:I(M.value.imageUrl),class:"upload-image"},null,8,D)):(n(),f(r,{key:1,class:"image-uploader-icon"},{default:v(()=>[c(h(b))]),_:1}))]),_:1},8,["action","headers"]),a[15]||(a[15]=p("div",{class:"upload-tip"},"支持jpg、png格式，大小不超过10MB",-1))])]),_:1}),c(x,{label:"标题"},{default:v(()=>[c($,{modelValue:M.value.title,"onUpdate:modelValue":a[1]||(a[1]=e=>M.value.title=e),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),c(x,{label:"比赛名称"},{default:v(()=>[c($,{modelValue:M.value.competitionName,"onUpdate:modelValue":a[2]||(a[2]=e=>M.value.competitionName=e),placeholder:"请输入比赛全称"},null,8,["modelValue"])]),_:1}),c(x,{label:"获奖人"},{default:v(()=>[c($,{modelValue:M.value.winners,"onUpdate:modelValue":a[3]||(a[3]=e=>M.value.winners=e),placeholder:"多人用逗号分隔，如：张三,李四"},null,8,["modelValue"])]),_:1}),c(x,{label:"获奖等级"},{default:v(()=>[c(E,{modelValue:M.value.awardLevel,"onUpdate:modelValue":a[4]||(a[4]=e=>M.value.awardLevel=e),placeholder:"请选择获奖等级",style:{width:"100%"}},{default:v(()=>[c(q,{label:"特等奖",value:"特等奖"}),c(q,{label:"一等奖",value:"一等奖"}),c(q,{label:"二等奖",value:"二等奖"}),c(q,{label:"三等奖",value:"三等奖"}),c(q,{label:"金奖",value:"金奖"}),c(q,{label:"银奖",value:"银奖"}),c(q,{label:"铜奖",value:"铜奖"}),c(q,{label:"优秀奖",value:"优秀奖"})]),_:1},8,["modelValue"])]),_:1}),c(x,{label:"获奖日期"},{default:v(()=>[c(F,{modelValue:M.value.awardDate,"onUpdate:modelValue":a[5]||(a[5]=e=>M.value.awardDate=e),type:"date",placeholder:"选择获奖日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),c(x,{label:"年份"},{default:v(()=>[c(G,{modelValue:M.value.year,"onUpdate:modelValue":a[6]||(a[6]=e=>M.value.year=e),min:2e3,max:2100,placeholder:"年份",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),c(x,{label:"描述"},{default:v(()=>[c($,{modelValue:M.value.description,"onUpdate:modelValue":a[7]||(a[7]=e=>M.value.description=e),type:"textarea",rows:4,placeholder:"请输入获奖描述"},null,8,["modelValue"])]),_:1}),c(x,{label:"首页展示"},{default:v(()=>[c(J,{modelValue:M.value.featured,"onUpdate:modelValue":a[8]||(a[8]=e=>M.value.featured=e)},null,8,["modelValue"])]),_:1}),c(x,{label:"显示顺序"},{default:v(()=>[c(G,{modelValue:M.value.displayOrder,"onUpdate:modelValue":a[9]||(a[9]=e=>M.value.displayOrder=e),min:0,placeholder:"数字越小越靠前",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-aed61153"]]);export{x as default};
